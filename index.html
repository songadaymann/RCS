<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Right Click Save KILL</title>
  <style>
    /* IBM Plex Mono Font */
    @font-face {
      font-family: 'IBM Plex Mono';
      src: url('./assets/fonts/IBM_Plex_Mono/IBMPlexMono-Thin.ttf') format('truetype');
      font-weight: 200;
      font-style: normal;
    }
    @font-face {
      font-family: 'IBM Plex Mono';
      src: url('./assets/fonts/IBM_Plex_Mono/IBMPlexMono-ThinItalic.ttf') format('truetype');
      font-weight: 200;
      font-style: italic;
    }
    @font-face {
      font-family: 'IBM Plex Mono';
      src: url('./assets/fonts/IBM_Plex_Mono/IBMPlexMono-Regular.ttf') format('truetype');
      font-weight: 400;
      font-style: normal;
    }
    @font-face {
      font-family: 'IBM Plex Mono';
      src: url('./assets/fonts/IBM_Plex_Mono/IBMPlexMono-Bold.ttf') format('truetype');
      font-weight: 700;
      font-style: normal;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #0a0c10;
      touch-action: none;
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 200;
    }
    #renderCanvas {
      width: 100%;
      height: 100%;
      display: block;
      outline: none;
    }
    #loadingScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #0a0c10;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 100;
      transition: opacity 0.5s ease-out;
    }
    #loadingScreen.hidden {
      opacity: 0;
      pointer-events: none;
    }
    #loadingText {
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 200;
      font-size: 24px;
      color: #00ff00;
      text-shadow: 0 0 10px #00ff00;
      letter-spacing: 4px;
    }
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    #loadingText::after {
      content: "...";
      animation: blink 1s infinite;
    }
    
    /* FPS Counter */
    #fpsCounter {
      position: fixed;
      bottom: 20px;
      right: 20px;
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 200;
      font-size: 14px;
      color: #00ff00;
      background: rgba(0, 0, 0, 0.7);
      padding: 5px 10px;
      border-radius: 4px;
      z-index: 50;
    }
    #fpsCounter.low {
      color: #ff0000;
    }
    #fpsCounter.medium {
      color: #ffcc00;
    }
    
    /* Health Bar */
    #healthContainer {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 200px;
      height: 20px;
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #ff3333;
      border-radius: 10px;
      overflow: hidden;
      z-index: 50;
    }
    #healthBar {
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, #ff0000, #ff4444);
      transition: width 0.2s ease-out;
      box-shadow: 0 0 10px #ff0000 inset;
    }
    #healthText {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 700;
      font-size: 12px;
      color: #fff;
      text-shadow: 1px 1px 2px #000;
    }
    
    /* Kill Counter */
    #killCounter {
      position: fixed;
      top: 50px;
      left: 50%;
      transform: translateX(-50%);
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 200;
      font-size: 18px;
      color: #ffcc00;
      text-shadow: 0 0 10px #ffcc00;
      letter-spacing: 2px;
      z-index: 50;
    }
    #killCount {
      color: #00ff66;
      font-weight: bold;
    }
    
    /* Wave Timer */
    #waveTimer {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 200;
      font-size: 24px;
      color: #fff;
      text-shadow: 0 0 10px #ff6600;
      letter-spacing: 2px;
      z-index: 50;
    }
    #waveTimer.urgent {
      color: #ff0000;
      animation: timerPulse 0.5s ease-in-out infinite alternate;
    }
    @keyframes timerPulse {
      from { transform: translateX(-50%) scale(1); }
      to { transform: translateX(-50%) scale(1.1); }
    }
    
    /* Enemies Remaining HUD */
    #enemiesRemaining {
      position: fixed;
      top: 110px;
      left: 50%;
      transform: translateX(-50%);
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 200;
      font-size: 18px;
      color: #ff3333;
      text-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000;
      letter-spacing: 1px;
      z-index: 50;
      text-align: center;
      display: none;
      animation: enemyPulse 0.8s ease-in-out infinite alternate;
    }
    #enemiesRemaining .count {
      font-size: 28px;
      font-weight: bold;
      display: block;
      margin-bottom: 4px;
    }
    @keyframes enemyPulse {
      from { opacity: 0.8; }
      to { opacity: 1; text-shadow: 0 0 15px #ff0000, 0 0 30px #ff0000; }
    }
    
    /* Wave Announcement */
    #waveAnnounce {
      position: fixed;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 200;
      font-size: clamp(32px, 8vw, 64px);
      color: #fff;
      text-shadow: 0 0 30px #ff0000, 0 0 60px #ff0000;
      letter-spacing: 8px;
      z-index: 60;
      opacity: 0;
      transition: opacity 0.3s ease-out;
      pointer-events: none;
      text-align: center;
    }
    #waveAnnounce.visible {
      opacity: 1;
    }
    #waveAnnounce.survive {
      color: #00ff66;
      text-shadow: 0 0 30px #00ff66, 0 0 60px #00ff66;
    }
    #waveAnnounce.final {
      color: #ff0000;
      animation: waveFlash 0.5s ease-in-out infinite alternate;
    }
    @keyframes waveFlash {
      from { text-shadow: 0 0 30px #ff0000, 0 0 60px #ff0000; }
      to { text-shadow: 0 0 50px #ff0000, 0 0 100px #ff6600; }
    }
    
    /* Hit Flash Overlay */
    #hitFlash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(ellipse at center, transparent 0%, rgba(255, 0, 0, 0.4) 100%);
      pointer-events: none;
      opacity: 0;
      z-index: 40;
      transition: opacity 0.1s ease-out;
    }
    #hitFlash.active {
      opacity: 1;
    }
    
    /* Radar HUD */
    #radar {
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 120px;
      height: 120px;
      background: rgba(0, 20, 40, 0.7);
      border: 2px solid rgba(0, 255, 100, 0.5);
      border-radius: 50%;
      z-index: 50;
      overflow: hidden;
    }
    #radarCenter {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 8px;
      height: 8px;
      background: #00ff66;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 6px #00ff66;
    }
    #radarDirection {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 2px;
      height: 25px;
      background: rgba(0, 255, 100, 0.4);
      transform-origin: bottom center;
      transform: translate(-50%, -100%);
    }
    .radarDot {
      position: absolute;
      width: 6px;
      height: 6px;
      background: #ff3366;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 4px #ff3366;
    }
    
    /* Collection Counter HUD */
    #collectCounter {
      position: fixed;
      top: 20px;
      left: 20px;
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 200;
      font-size: 24px;
      color: #ffcc00;
      text-shadow: 0 0 10px #ffcc00, 0 0 20px #ff8800;
      letter-spacing: 2px;
      z-index: 50;
    }
    
    /* Boss Health Bar */
    #bossHealthContainer {
      position: fixed;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      width: 60%;
      max-width: 500px;
      height: 30px;
      background: rgba(0, 0, 0, 0.8);
      border: 3px solid #ff3333;
      border-radius: 15px;
      overflow: hidden;
      z-index: 50;
      display: none;
    }
    #bossHealthBar {
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, #990000, #ff0000, #ff4444);
      transition: width 0.3s ease-out;
      box-shadow: 0 0 20px #ff0000 inset, 0 0 10px #ff0000;
    }
    #bossHealthLabel {
      position: absolute;
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 700;
      font-size: 18px;
      color: #ff0000;
      text-shadow: 0 0 10px #ff0000;
      letter-spacing: 4px;
    }
    
    /* Win Screen */
    #winScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 200;
    }
    #winScreen h1 {
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 200;
      font-size: 48px;
      color: #00ff66;
      text-shadow: 0 0 20px #00ff66, 0 0 40px #00ff66;
      letter-spacing: 8px;
      margin-bottom: 20px;
      animation: pulse 1s ease-in-out infinite alternate;
    }
    #winScreen p {
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 200;
      font-size: 18px;
      color: #888;
    }
    @keyframes pulse {
      from { transform: scale(1); }
      to { transform: scale(1.05); }
    }
    
    /* Title Screen */
    #titleScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 300;
      cursor: pointer;
      transition: opacity 0.8s ease-out;
    }
    #titleScreen.hidden {
      opacity: 0;
      pointer-events: none;
    }
    #titleVideo {
      width: 300px;
      height: auto;
      max-width: 80vw;
      margin-bottom: 30px;
      filter: grayscale(100%) brightness(0.3);
      clip-path: inset(100% 0 0 0);
      transition: filter 0.5s ease-out;
    }
    #titleVideo.revealed {
      filter: grayscale(0%) brightness(1);
      clip-path: inset(0 0 0 0);
    }
    #loadingPercent {
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 200;
      font-size: 14px;
      color: #00ff00;
      text-shadow: 0 0 10px #00ff00;
      letter-spacing: 2px;
      margin-bottom: 20px;
      opacity: 1;
      transition: opacity 0.3s ease-out;
    }
    #loadingPercent.hidden {
      opacity: 0;
    }
    #titleText {
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 200;
      font-size: clamp(28px, 6vw, 48px);
      letter-spacing: 4px;
      text-align: center;
      margin-bottom: 40px;
    }
    #titleText .white {
      color: #fff;
    }
    #titleText .kill {
      color: #ff0000;
      text-shadow: 0 0 20px #ff0000, 0 0 40px #ff0000;
    }
    #flashWarning {
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 200;
      font-size: 14px;
      color: #ff6600;
      text-shadow: 0 0 10px #ff6600;
      letter-spacing: 1px;
      text-align: center;
      margin-bottom: 30px;
      padding: 10px 20px;
      border: 1px solid rgba(255, 102, 0, 0.5);
      border-radius: 4px;
      background: rgba(255, 102, 0, 0.1);
    }
    #startPrompt {
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 200;
      font-size: 18px;
      color: #888;
      letter-spacing: 2px;
      animation: blink 1.5s ease-in-out infinite;
    }
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
    
    /* Mobile Controls */
    #mobileControls {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 80;
    }
    @media (pointer: coarse) {
      #mobileControls {
        display: block;
      }
      #radar {
        display: none;
      }
      #fpsCounter {
        bottom: auto;
        top: 10px;
        right: 10px;
        font-size: 11px;
        padding: 3px 6px;
      }
    }
    
    /* Analog Stick (Left Side) */
    #joystickArea {
      position: absolute;
      bottom: 20px;
      left: 20px;
      width: 150px;
      height: 150px;
      pointer-events: auto;
      touch-action: none;
    }
    #joystickBase {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 120px;
      height: 120px;
      background: radial-gradient(circle at center, rgba(0, 255, 100, 0.1) 0%, rgba(0, 255, 100, 0.05) 60%, rgba(0, 255, 100, 0.15) 100%);
      border: 2px solid rgba(0, 255, 100, 0.4);
      border-radius: 50%;
      box-shadow: 0 0 20px rgba(0, 255, 100, 0.2), inset 0 0 30px rgba(0, 255, 100, 0.05);
    }
    #joystickKnob {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 50px;
      height: 50px;
      background: radial-gradient(circle at 30% 30%, rgba(0, 255, 100, 0.6), rgba(0, 255, 100, 0.3));
      border: 2px solid rgba(0, 255, 100, 0.7);
      border-radius: 50%;
      box-shadow: 0 0 15px rgba(0, 255, 100, 0.5), 0 4px 8px rgba(0, 0, 0, 0.4);
      transition: transform 0.05s ease-out;
    }
    
    /* Action Buttons (Right Side) */
    #buttonArea {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 160px;
      height: 120px;
      pointer-events: auto;
      touch-action: none;
    }
    .actionButton {
      position: absolute;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 700;
      font-size: 24px;
      user-select: none;
      -webkit-user-select: none;
      touch-action: none;
      transition: transform 0.1s ease-out, box-shadow 0.1s ease-out;
    }
    .actionButton:active, .actionButton.pressed {
      transform: scale(0.9);
    }
    #shootButton {
      bottom: 0;
      right: 0;
      background: radial-gradient(circle at 30% 30%, rgba(255, 50, 50, 0.7), rgba(200, 0, 0, 0.5));
      border: 3px solid rgba(255, 100, 100, 0.8);
      color: #fff;
      text-shadow: 0 0 10px #ff0000;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.4), 0 4px 8px rgba(0, 0, 0, 0.4);
    }
    #shootButton:active, #shootButton.pressed {
      box-shadow: 0 0 30px rgba(255, 0, 0, 0.7), 0 2px 4px rgba(0, 0, 0, 0.4);
    }
    #jumpButton {
      bottom: 45px;
      right: 75px;
      background: radial-gradient(circle at 30% 30%, rgba(100, 150, 255, 0.7), rgba(50, 100, 200, 0.5));
      border: 3px solid rgba(150, 180, 255, 0.8);
      color: #fff;
      text-shadow: 0 0 10px #4488ff;
      box-shadow: 0 0 20px rgba(50, 100, 255, 0.4), 0 4px 8px rgba(0, 0, 0, 0.4);
    }
    #jumpButton:active, #jumpButton.pressed {
      box-shadow: 0 0 30px rgba(50, 100, 255, 0.7), 0 2px 4px rgba(0, 0, 0, 0.4);
    }
    
    /* Level Instruction Popup */
    #levelInstruction {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 200;
      pointer-events: none;
      background: rgba(0, 0, 0, 0.6);
      opacity: 0;
      transition: opacity 0.5s ease-out;
    }
    #levelInstruction.visible {
      display: flex;
      opacity: 1;
    }
    #levelInstruction.fadeOut {
      opacity: 0;
    }
    #levelInstructionText {
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 200;
      font-size: clamp(32px, 8vw, 64px);
      color: #fff;
      text-shadow: 0 0 30px #00ff66, 0 0 60px #00ff66;
      letter-spacing: 6px;
      text-align: center;
      text-transform: uppercase;
      animation: instructionPulse 1s ease-in-out infinite alternate;
    }
    #levelInstructionText.boss {
      text-shadow: 0 0 30px #ff0000, 0 0 60px #ff0000;
      animation: instructionPulseBoss 0.5s ease-in-out infinite alternate;
    }
    @keyframes instructionPulse {
      from { transform: scale(1); text-shadow: 0 0 30px #00ff66, 0 0 60px #00ff66; }
      to { transform: scale(1.05); text-shadow: 0 0 50px #00ff66, 0 0 100px #00ff66; }
    }
    @keyframes instructionPulseBoss {
      from { transform: scale(1); text-shadow: 0 0 30px #ff0000, 0 0 60px #ff0000; }
      to { transform: scale(1.1); text-shadow: 0 0 60px #ff0000, 0 0 120px #ff6600; }
    }
    
    /* End Game Stats Overlay - Terminal Style */
    #endGameStats {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 250;
      animation: statsReveal 0.3s ease-out;
    }
    @keyframes statsReveal {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .stats-container {
      background: #0a0a0a;
      border: 1px solid #333;
      padding: 20px 30px;
      min-width: 340px;
      max-width: 90vw;
      font-family: 'IBM Plex Mono', monospace;
    }
    .stats-title {
      font-weight: 400;
      font-size: 14px;
      color: #fff;
      letter-spacing: 2px;
      text-align: center;
      margin-bottom: 8px;
      border-bottom: 1px solid #333;
      padding-bottom: 10px;
    }
    .stats-title .kill {
      color: #ff3333;
    }
    .stats-container h2 {
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 400;
      font-size: 18px;
      color: #0f0;
      letter-spacing: 2px;
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #333;
    }
    .stat-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      font-size: 14px;
    }
    .stat-row.total {
      border-top: 1px solid #333;
      margin-top: 12px;
      padding-top: 12px;
    }
    .stat-label {
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 400;
      color: #888;
      letter-spacing: 0;
    }
    .stat-row.total .stat-label {
      color: #0f0;
    }
    .stat-value {
      font-family: 'IBM Plex Mono', monospace;
      font-weight: 400;
      color: #0f0;
    }
    .stat-row.total .stat-value {
      color: #0f0;
    }
    .stats-cursor {
      display: inline-block;
      width: 8px;
      height: 14px;
      background: #0f0;
      margin-left: 4px;
      animation: cursorBlink 1s step-end infinite;
    }
    @keyframes cursorBlink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }
    
  </style>
</head>
<body>
  <!-- Title Screen (also handles loading) -->
  <div id="titleScreen">
    <video id="titleVideo" autoplay loop muted playsinline>
      <source src="./assets/right-click-save.mp4" type="video/mp4">
    </video>
    <div id="loadingPercent">0%</div>
    <div id="titleText">
      <span class="white">Right-Click Save</span> <span class="kill">KILL</span>
    </div>
    <div id="flashWarning">âš  WARNING: This game contains flashing lights</div>
    <div id="startPrompt" style="opacity: 0;">click or tap to start</div>
  </div>
  <canvas id="renderCanvas" style="display: none;"></canvas>
  
  <!-- FPS Counter -->
  <div id="fpsCounter">60 FPS</div>
  
  <!-- Health Bar -->
  <div id="healthContainer">
    <div id="healthBar"></div>
    <div id="healthText">100</div>
  </div>
  
  <!-- Kill Counter -->
  <div id="killCounter">
    <span id="killCount">0</span> KILLS
  </div>
  
  <!-- Wave Timer -->
  <div id="waveTimer">2:00</div>
  
  <!-- Enemies Remaining (shown after waves complete) -->
  <div id="enemiesRemaining">
    <span class="count" id="enemiesRemainingCount">0</span>
    DESTROY REMAINING ENEMIES!
  </div>
  
  <!-- Wave Announcement -->
  <div id="waveAnnounce"></div>
  
  <!-- Hit Flash Overlay -->
  <div id="hitFlash"></div>
  
  <!-- Radar HUD -->
  <div id="radar">
    <div id="radarDirection"></div>
    <div id="radarCenter"></div>
  </div>
  
  <!-- Collection Counter (City Level - hidden initially) -->
  <div id="collectCounter" style="display: none;">0 / 8</div>
  
  <!-- Boss Health Bar (Boss Level - hidden initially) -->
  <div id="bossHealthContainer">
    <div id="bossHealthLabel">RCS</div>
    <div id="bossHealthBar"></div>
  </div>
  
  <!-- Win Screen -->
  <div id="winScreen">
    <h1>LEVEL COMPLETE</h1>
    <p>All artifacts collected!</p>
  </div>
  
  <!-- Level Instruction Popup (shows at start of each level) -->
  <div id="levelInstruction">
    <div id="levelInstructionText">COLLECT ART</div>
  </div>
  
  <!-- Mobile Controls (analog stick + buttons) -->
  <div id="mobileControls">
    <!-- Analog Stick (Left) -->
    <div id="joystickArea">
      <div id="joystickBase">
        <div id="joystickKnob"></div>
      </div>
    </div>
    <!-- Action Buttons (Right) -->
    <div id="buttonArea">
      <div id="jumpButton" class="actionButton">B</div>
      <div id="shootButton" class="actionButton">A</div>
    </div>
  </div>
  
  <!-- Babylon.js (UMD bundle from official CDN) -->
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
  
  <!-- City Level Module (loaded before game.js assigns to window) -->
  <script type="module">
    import { CityLevel } from './src/levels/city.js?v=2';
    window.CityLevel = CityLevel;
  </script>
  
  <!-- Title Screen Handler -->
  <script>
    window.gameStarted = false;
    window.gameLoaded = false;
    
    // Loading progress callback - called from game.js
    window.onLoadingProgress = function(percent) {
      const video = document.getElementById('titleVideo');
      const loadingPercent = document.getElementById('loadingPercent');
      const startPrompt = document.getElementById('startPrompt');
      
      if (loadingPercent) {
        loadingPercent.textContent = Math.round(percent) + '%';
      }
      
      if (video) {
        // Reveal video from bottom to top based on loading progress
        const revealPercent = 100 - percent;
        video.style.clipPath = `inset(${revealPercent}% 0 0 0)`;
        // Gradually reduce grayscale and increase brightness
        const grayscale = 100 - percent;
        const brightness = 0.3 + (0.7 * (percent / 100));
        video.style.filter = `grayscale(${grayscale}%) brightness(${brightness})`;
      }
      
      if (percent >= 100) {
        window.gameLoaded = true;
        if (loadingPercent) loadingPercent.classList.add('hidden');
        if (startPrompt) {
          startPrompt.style.opacity = '1';
          startPrompt.style.animation = 'blink 1.5s ease-in-out infinite';
        }
        if (video) video.classList.add('revealed');
      }
    };
    
    document.addEventListener('DOMContentLoaded', () => {
      const titleScreen = document.getElementById('titleScreen');
      const canvas = document.getElementById('renderCanvas');
      const titleText = document.getElementById('titleText');
      
      // Check if we're transitioning from another level
      const nextLevel = sessionStorage.getItem('nextLevel');
      if (nextLevel === 'city' && titleText) {
        // Level 2 transition - replace title text
        titleText.innerHTML = '<span class="white">LEVEL</span> <span class="kill">2</span>';
      } else if (nextLevel === 'boss' && titleText) {
        // Boss fight transition - replace title text
        titleText.innerHTML = '<span class="kill">BOSS FIGHT</span>';
      }
      
      // Start loading game immediately (in background)
      canvas.style.display = 'block';
      canvas.style.opacity = '0';
      const script = document.createElement('script');
      script.src = './src/game.js';
      document.body.appendChild(script);
      
      // Click/tap to start (only works after loaded)
      titleScreen.addEventListener('click', () => {
        if (window.gameStarted) return;
        if (!window.gameLoaded) return; // Can't start until loaded
        
        window.gameStarted = true;
        
        // Hide title, show game
        titleScreen.classList.add('hidden');
        canvas.style.opacity = '1';
      });
      
      // Also handle touch for mobile
      titleScreen.addEventListener('touchend', (e) => {
        e.preventDefault();
        titleScreen.click();
      });
    });
  </script>
</body>
</html>
